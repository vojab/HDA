@{
    ViewBag.Title = "Help Desk Requests";
}
@section featured {
    <section class="featured">
        <div class="content-wrapper">
            @*            <hgroup class="hero-unit">
                <h1>@ViewBag.Title.</h1>
                <h4>@ViewBag.Message</h4>
            </hgroup>*@

            <div id="myCarousel" class="carousel">
                <div class="carousel-inner">
                    <div class="item active">
                        <img src="~/Images/blue-abstract-header.jpg" alt="" />
                        <div class="container">
                            <div class="carousel-caption">
                                <h1>Help Desk Application.</h1>
                                <p class="lead">
                                    Offers a high quality, efficient support service 24 hours a day to the customers, regardless of their geographical location.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="loginArea" class="form-signin" data-bind="visible: isUserAuthenticated() === false">

                <h2 class="form-signin-heading">Please sign in</h2>
                <input class="input-block-level" type="text" placeholder="User Name"
                    name="username" data-bind="value: userName">
                <input class="input-block-level" type="password" placeholder="Password"
                    name="password" data-bind="value: password">
                <button class="btn btn-large btn-primary" type="submit"
                    data-bind="click: loadUser">
                    Sign in</button>

            </div>

            <div id="authorizedArea" class="hero-unit" data-bind="visible: isUserAuthenticated() === true">

                <div id="userArea">

                    <div class="navbar-wrapper">
                        <div class="container">
                            <div class="navbar navbar-inverse">
                                <div class="navbar-inner">
                                    <div class="nav-collapse collapse">
                                        <ul class="nav">
                                            <li class="active">
                                                <a>
                                                    <input data-bind="value: keywordFilter, valueUpdate: 'afterkeydown'"
                                                        type="text" class="search-query" placeholder="Search"></a>
                                            </li>
                                            <li>
                                                <a>
                                                    <select class="span2" data-bind="options: requestStatusOptions,
    optionsText: 'RequestStatusName',
    value: selectedFilterRequestStatusOption">
                                                    </select></a>
                                            </li>
                                            <li>
                                                <a id="newRequest"
                                                    href="#"
                                                    data-bind="click: openModalForNewRequest"
                                                    data-toggle="modal"
                                                    data-target="#newRequestModal">* NEW Help Desk Request</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <p class="navbar-text pull-right">
                                        <i class="icon-user"></i>
                                        Welcome: 
                                <a data-bind="text: loggedInUser().UserName()" class="navbar-link" href="#">Username</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="adminModule" data-bind="visible: loadAdminModule()">
                        <p>Hello ADMIN</p>
                    </div>

                    <div id="clientModule" data-bind="visible: loadClientModule()">
                        <p>Hello CLIENT</p>
                    </div>

                    <div id="businessModule" data-bind="visible: loadBusinessModule()">
                        <p>Hello BUSINESS</p>
                    </div>

                    <div id="helpDeskModule" data-bind="visible: loadHelpDeskModule()">
                        <p>Hello HELP DESK</p>
                    </div>

                    <div id="requestsArea">
                    </div>

                    <div id="requestModalArea">
                    </div>

                    <div id="newRequestModalArea">
                    </div>

                    <div id="assignToUserModalArea">
                    </div>

                    <div id="changeRequestStatusModalArea">
                    </div>

                    <div id="requestStatusHistoryModalArea">
                    </div>
                    
                    <div id="assignedUserHistoryModalArea">
                    </div>

                </div>

            </div>
        </div>
    </section>
}
@*HDA SPA Entry Point*@
<script src="~/Scripts/Main.js"></script>

@*Templates section*@
<script type="text/html" id="requestsListTemplate">
    <table class="table table-striped">
        <thead>
            <tr>
                <th></th>
                <th>Id</th>
                <th>Subject</th>
                <th>Description</th>
                <th>Status</th>
                <th>Open Date</th>
                <th>Closed Date</th>
                <th>Assigned To</th>
                <th>Product Name</th>
                <th>Product</th>
            </tr>
        </thead>
        <tbody data-bind="foreach: filteredRequestsByRequestStatus">
            <tr>
                <td>
                    <li id="actions" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li class="nav-header">Actions</li>
                            <li>
                                <a href="#"
                                   data-bind="click: openRequest.bind($data)"
                                   data-toggle="modal"
                                   data-target="#requestModal">Open request</a>
                            </li>
                            <li>
                                <a href="#"
                                   data-bind="click: openAssignToUserModal.bind($data)"
                                   data-toggle="modal"
                                   data-target="#assignToUserModal">Assign request</a>
                            </li>
                            <li>
                                <a href="#"
                                   data-bind="click: deleteRequest.bind($data)">Delete request</a>
                            </li>
                            <li>
                                <a href="#"
                                   data-bind="click: openChangeRequestsStatusModal.bind($data)"
                                   data-toggle="modal"
                                   data-target="#changeRequestStatusModal">Change status</a>
                            </li>
                            <li class="divider"></li>
                            <li class="nav-header">History</li>
                            <li>
                                <a href="#"
                                   data-bind="click: openRequestStatusHistory.bind($data)"
                                   data-toggle="modal"
                                   data-target="#requestStatusHistoryModal">Request status history</a>
                            </li>
                            <li>
                                <a href="#"
                                   data-bind="click: openAssignedUserHistory.bind($data)"
                                   data-toggle="modal"
                                   data-target="#assignedUserHistoryModal">Assigned user history</a>
                            </li>
                            <li class="divider"></li>
                            <li class="nav-header">Admin section</li>
                            <li>
                                <a href="#">User management</a>
                            </li>
                        </ul>
                    </li>
                </td>
                <td data-bind="text: RequestId()"></td>
                <td data-bind="text: RequestSubject()"></td>
                <td data-bind="text: RequestDescription()"></td>
                <td data-bind="text: CurrentRequestStatus().RequestStatusName()"></td>
                <td data-bind="text: RequestOpenDate().substring(0, 10)"></td>
                <td data-bind="text: RequestClosedDate().substring(0, 10)"></td>
                <td data-bind="text: CurrentAssignedUser().UserName()"></td>
                <td data-bind="text: Product().ProductName()"></td>
                <td data-bind="text: Product().ProductDescription()"></td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/html" id="changeRequestStatusModalTemplate">
    <div id="changeRequestStatusModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="changeRequestStatusModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="changeRequestStatusModalLabel">Change request status</h3>
        </div>
        <div class="modal-body">
            <p>Change help desk request status to:</p>
            <label>Request Status:</label>
            <select class="span2" data-bind="options: requestStatusOptions,
    optionsText: 'RequestStatusName',
    value: selectedRequestStatusOption">
            </select>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary" data-bind="click: changeRequestStatus">Change request status</button>
        </div>
    </div>
</script>

<script type="text/html" id="assignToUserModalTemplate">
    <div id="assignToUserModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="assignToUserModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="assignToUserModalLabel">Assign request to the user</h3>
        </div>
        <div class="modal-body">
            <p>Assign Help Desk Request To The User:...</p>
            <label>Users:</label>
            <select class="span2" data-bind="options: users,
    optionsText: 'UserName',
    value: selectedUser">
            </select>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary" data-bind="click: assignToUser">Assign to the user</button>
        </div>
    </div>
</script>

<script type="text/html" id="requestDetailsModalTemplate">
    <div id="requestModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="requestDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="requestDetailsModalLabel">Help Desk Request Details</h3>
        </div>
        <div class="modal-body">
            <label>Help desk request subject:</label>
            <label data-bind="text: selectedRequest().RequestSubject()"></label>
            <br />
            <label>Help desk request product:</label>
            <label data-bind="text: selectedRequest().Product().ProductName()"></label>
            <br />
            <label>Help desk request description:</label>
            <textarea id="requestDetailsDescription" name="requestDetailsDescription"
                cols="40"
                style="width: 300px; height: 100px;"
                data-bind="nicedit: selectedRequest().RequestDescription"></textarea>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary">Save help desk request</button>
        </div>
    </div>
</script>

<script type="text/html" id="newRequestModalTemplate">
    <div id="newRequestModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="newRequestModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="newRequestModalLabel">New Help Desk Request</h3>
        </div>
        <div class="modal-body">
            <p>Please enter details about new help desk request:</p>
            <label>Help desk request subject:</label>
            <input id="requestSubject" name="requestSubject" data-bind="value: newRequest().RequestSubject" type="text" />
            <label>Help desk request product:</label>
            <select class="span2" data-bind="options: products,
    optionsText: 'ProductName',
    value: selectedProduct">
            </select>
            <label>Help desk request details:</label>
            <textarea id="requestDescription"
                name="requestDescription"
                cols="40"
                style="width: 300px; height: 100px;"
                data-bind="nicedit: newRequest().RequestDescription"></textarea>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button data-bind="click: saveRequest"
                class="btn btn-primary">
                Save new help desk request</button>
        </div>
    </div>
</script>

<script type="text/html" id="requestStatusHistoryModalTemplate">
    <div id="requestStatusHistoryModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="requestStatusHistoryModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="requestStatusHistoryModalLabel">Request status history</h3>
        </div>
        <div class="modal-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Request Status Name</th>
                        <th>Date/Time Changed</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: selectedRequest().RequestStatusChanges()">
                    <tr>
                        <td data-bind="text: RequestStatus().RequestStatusName()"></td>
                        <td data-bind="text: DateCreated()"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </div>
</script>

<script type="text/html" id="assignedUserHistoryModalTemplate">
    <div id="assignedUserHistoryModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="assignedUserHistoryModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="assignedUserHistoryModalLabel">Assigned users history</h3>
        </div>
        <div class="modal-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>User Name</th>
                        <th>Date/Time Changed</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: selectedRequest().AssignedUserChanges()">
                    <tr>
                        <td data-bind="text: User().UserName()"></td>
                        <td data-bind="text: DateCreated()"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </div>
</script>