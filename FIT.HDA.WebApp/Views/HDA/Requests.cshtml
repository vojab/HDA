@{
    ViewBag.Title = "Help Desk Requests";
}
@section featured {
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>@ViewBag.Title.</h1>
                <h4>@ViewBag.Message</h4>
            </hgroup>
            
            <div id="loginArea" data-bind="visible: isUserAuthenticated() === false">
                
                <div>
                    <p>Please enter your login details</p>
                    <label>User Name: </label>
                    <input type="text" name="username" data-bind="value: userName" />
                    <label>Password: </label>
                    <input type="password" name="password" data-bind="value: password" />
                </div>
                <div>
                    <button class="btn btn-primary" data-bind="click: loadUser">Log In</button>
                </div>

            </div>
            
            <div id="authorizedArea" data-bind="visible: isUserAuthenticated() === true">
                
                <div id="userArea">
                    <p>
                        Welcome, 
                        <i class="icon-user"></i>
                        <label data-bind="text: loggedInUser().UserName()"></label>
                    </p>
                </div>

                <div id="filterArea">
                    <input data-bind="value: keywordFilter, valueUpdate: 'afterkeydown'"
                           type="text" class="search-query" placeholder="Search">

                    <br />

                    <p>Filter requests by status: </p>
                    <select class="span2" data-bind="options: requestStatusOptions,
                                                    optionsText: 'RequestStatusName',
                                                    value: selectedFilterRequestStatusOption">
                    </select>
                </div>
                
                <div id="adminModule" data-bind="visible: loadAdminModule()">
                    <p>Hello ADMIN</p>
                </div>
                
                <div id="clientModule" data-bind="visible: loadClientModule()">
                    <p>Hello CLIENT</p>
                </div>
                
                <div id="businessModule" data-bind="visible: loadBusinessModule()">
                    <p>Hello BUSINESS</p>
                </div>
                
                <div id="helpDeskModule" data-bind="visible: loadHelpDeskModule()">
                    <p>Hello HELP DESK</p>
                </div>

                <div id="requestsArea">
                </div>

                <div id="requestModalArea">
                </div>

                <div id="newRequestModalArea">
                </div>

                <div id="assignToUserModalArea">
                </div>

                <div id="changeRequestStatusModalArea">
                </div>

                <div>
                    <button data-bind="click: openModalForNewRequest"
                            class="btn"
                            type="button"
                            data-toggle="modal"
                            data-target="#newRequestModal">
                        NEW Help Desk Request</button>
                </div>

            </div>

        </div>
    </section>
}
@*HDA SPA Entry Point*@
<script src="~/Scripts/Main.js"></script>

@*Templates section*@
<script type="text/html" id="requestsListTemplate">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Request Description</th>
                <th>Request Status</th>
                <th>Request Open Date</th>
                <th>Request Closed Date</th>
                <th>Assigned To</th>
                <th>Product Name</th>
                <th>Product Description</th>
                <th></th>
            </tr>
        </thead>
        <tbody data-bind="foreach: filteredRequestsByRequestStatus">
            <tr>
                <td data-bind="text: RequestId()"></td>
                <td data-bind="text: RequestDescription()"></td>
                <td data-bind="text: CurrentRequestStatus().RequestStatusName()"></td>
                <td data-bind="text: RequestOpenDate()"></td>
                <td data-bind="text: RequestClosedDate()"></td>
                <td data-bind="text: CurrentAssignedUser().UserName()"></td>
                <td data-bind="text: Product().ProductName()"></td>
                <td data-bind="text: Product().ProductDescription()"></td>
                <td>
                    <button data-bind="click: openRequest.bind($data)"
                        class="btn"
                        type="button"
                        data-toggle="modal"
                        data-target="#requestModal">
                        Open
                    </button>
                </td>
                <td>
                    <button data-bind="click: openAssignToUserModal.bind($data)"
                        class="btn"
                        type="button"
                        data-toggle="modal"
                        data-target="#assignToUserModal">
                        Assign
                    </button>
                </td>
                <td>
                    <button data-bind="click: openChangeRequestsStatusModal.bind($data)"
                        class="btn"
                        type="button"
                        data-toggle="modal"
                        data-target="#changeRequestStatusModal">
                        Change Request Status
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
</script>

<script type="text/html" id="changeRequestStatusModalTemplate">
    <div id="changeRequestStatusModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="changeRequestStatusModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="changeRequestStatusModalLabel">Change request status</h3>
        </div>
        <div class="modal-body">
            <p>Change help desk request status to:</p>
            <label>Request Status:</label>
            <select class="span2" data-bind="options: requestStatusOptions,
                                            optionsText: 'RequestStatusName',
                                            value: selectedRequestStatusOption">
            </select>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary" data-bind="click: changeRequestStatus">Change request status</button>
        </div>
    </div>
</script>

<script type="text/html" id="assignToUserModalTemplate">
    <div id="assignToUserModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="assignToUserModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="assignToUserModalLabel">Assign request to the user</h3>
        </div>
        <div class="modal-body">
            <p>Assign Help Desk Request To The User:...</p>
            <label>Users:</label>
            <select class="span2" data-bind="options: users,
                                            optionsText: 'UserName',
                                            value: selectedUser">
            </select>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary" data-bind="click: assignToUser">Assign to the user</button>
        </div>
    </div>
</script>

<script type="text/html" id="requestDetailsModalTemplate">
    <div id="requestModal"
        class="modal hide fade"
        tabindex="-1"
        role="dialog"
        aria-labelledby="requestDetailsModalLabel"
        aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="requestDetailsModalLabel">Help Desk Request Details...</h3>
        </div>
        <div class="modal-body">
            <p>Help Desk Request Details...</p>
            <label data-bind="text: selectedRequest().Product().ProductName()"></label>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary">Save help desk request</button>
        </div>
    </div>
</script>

<script type="text/html" id="newRequestModalTemplate">
    <div id="newRequestModal"
         class="modal hide fade"
         tabindex="-1"
         role="dialog"
         aria-labelledby="newRequestModalLabel"
         aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="newRequestModalLabel">Help desk request description</h3>
        </div>
        <div class="modal-body">
            <p>Help Desk Request Details...</p>
            <label>Help desk request description:</label>
            @*            <input id="requestDescription" name="requestDescription" data-bind="value: newRequest().RequestDescription"
                   type="text" />*@
            <textarea id="requestDescription" name="requestDescription" cols="40" style="width: 300px; height: 100px;"
                      data-bind="nicedit: newRequest().RequestDescription"></textarea>
            <br />
            <label>Help desk request product:</label>
            <select class="span2" data-bind="options: products,
                                            optionsText: 'ProductName',
                                            value: selectedProduct">
            </select>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button data-bind="click: saveRequest"
                class="btn btn-primary">
                Save new help desk request</button>
        </div>
    </div>
</script>
